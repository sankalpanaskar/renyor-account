<nb-card>
  <nb-card-header>Lead Details</nb-card-header>
  <nb-card-body [nbSpinner]="isSubmitting" nbSpinnerStatus="primary">
    <div class="row">
      <!-- Left Side: Timeline -->
      <div class="col-lg-4 col-md-12">
        <div style="border: 1px solid #ccc;padding: 10px; border-radius: 5px;padding-bottom: 27px;">
          <h5 style="font-size: 18px;color: #7a7e83;">Lead Activity</h5>
          <!-- <ul class="timeline">
            <li>
              <strong>Enrollment</strong> - <em>Pending</em><br />
              12th March, 2025 - 10:00 AM
            </li>
            <li>
              <strong>Prescreening</strong> - <em>Pending</em><br />
              10th March, 2025 - 10:00 AM
            </li>
            <li>
              <strong>CRD</strong> - <em>Pending</em><br />
              10th March, 2025 - 10:00 AM
            </li>
            <li>
              <strong>Student Counselling</strong> - <em>Completed</em><br />
              9th March, 2025 - 10:00 AM
            </li>
          </ul> -->
          <div class="row">
            <div class="col-md-12 col-lg-12">
              <div id="tracking-pre"></div>
              <div id="tracking">
                <div class="tracking-list">
                  <div class="tracking-item" *ngFor="let stage of leadFlowData">
                    <div class="tracking-icon status-intransit">
                      <svg class="svg-inline--fa fa-circle fa-w-16" aria-hidden="true" data-prefix="fas"
                        data-icon="circle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path fill="currentColor"
                          d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z">
                        </path>
                      </svg>
                    </div>

                    <div class="tracking-content">
                      {{ stage.lead_status }}
                      <span style="color:rgb(60 111 255);"> ({{stage.lead_stage}}) </span>
                      <span>
                        {{ stage.created_at | date: 'dd MMM yyyy, h:mma' }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>

      </div>

      <!-- Right Side: Form (unchanged) -->
      <div class="col-lg-8 col-md-12">
        <div style="border: 1px solid #ccc;padding: 10px; border-radius: 5px;">
          <h5 style="font-size: 18px;color: #7a7e83;">Basic Details</h5>
          <form #fm="ngForm" (ngSubmit)="onSubmit(fm)" novalidate id="leadForm">
            <div class="row">
              <div class="col-lg-12">
                <nb-card-body class="p-0">
                  <div class="row">
                    <div class="col-lg-6">
                      <label class="small-label"><strong>Name:</strong> {{ model.first_name }} {{ model.last_name
                        }}</label>
                    </div>
                    <div class="col-lg-6">
                      <label class="small-label"><strong>Mobile:</strong> {{ model.phone_number }}</label>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-lg-6">
                      <label class="small-label"><strong>Email:</strong> {{ model.email_id }}</label>
                    </div>
                    <div class="col-lg-6">
                      <label class="small-label"><strong>Center:</strong> {{ model.center_code }}</label>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-lg-6">
                      <label class="small-label"><strong>Course:</strong> {{ model.course }}</label>
                    </div>
                    <div class="col-lg-6">
                      <label class="small-label"><strong>State:</strong> {{ model.state }}</label>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-lg-6">
                      <label class="small-label"><strong>District:</strong> {{ model.distric }}</label>
                    </div>
                    <div class="col-lg-6">
                      <label class="small-label"><strong>Source Category:</strong> {{ model.category }}</label>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-lg-6">
                      <label class="small-label"><strong>Source Type:</strong> {{ model.source_type }}</label>
                    </div>
                    <div class="col-lg-6">
                      <label class="small-label"><strong>Status:</strong> {{ preselectedStatus }}</label>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-lg-6">
                      <label class="small-label"><strong>Source Type:</strong> {{ preselectedStage }}</label>
                    </div>
                    <div class="col-lg-6">
                      <label class="small-label"><strong>Follow Up Date:</strong> {{ preselectedFollowDate }}</label>
                    </div>
                  </div>
                  <div class="row">
                        <div class="col-lg-6" *ngIf="oriId != null">
                      <label class="small-label"><strong>ORI Number:</strong> {{ oriId }}</label>
                    </div>
                  </div>

                  <div class="row" *ngIf="!hideForm">
                    <div class="col-lg-6">
                      <nb-select shape="semi-round" placeholder="Select Status" name="status" required #status="ngModel"
                        [(ngModel)]="model.status" (selectedChange)="onStatusChange($event)">
                        <nb-option *ngFor="let status of statusList" [value]="status.id">
                          {{ status.updated_status }}
                        </nb-option>
                      </nb-select>
                      <div *ngIf="fm.submitted && status.invalid" class="error-message">Source type is required</div>
                    </div>

                    <div class="col-lg-6">
                      <nb-select shape="semi-round" placeholder="Select Stage Status" name="stage" required
                        #stage="ngModel" [(ngModel)]="model.stage" (selectedChange)="onStageChange($event)">
                        <nb-option *ngFor="let stage of stageList" [value]="stage.lead_stage">
                          {{ stage.updated_stage }}
                        </nb-option>
                      </nb-select>
                      <div *ngIf="fm.submitted && stage.invalid" class="error-message">Source type is required</div>
                    </div>
                  </div>

                  <div class="row">

                    <div class="col-lg-6" *ngIf="showDateField">
                      <input nbInput fullWidth placeholder="Select Follow Up Date" [nbDatepicker]="datePicker"
                        [(ngModel)]="model.follow_up_date" name="follow_up_date" required #follow_up_date="ngModel" />
                      <nb-datepicker #datePicker></nb-datepicker>
                      <div *ngIf="fm.submitted && follow_up_date.invalid" class="error-message">Date is required</div>

                    </div>

                  </div>


                  <div class="mt-3">
                    <button *ngIf="!hideForm" nbButton status="primary" shape="semi-round" hero type="submit"
                      [disabled]="isSubmitting">
                      Save
                    </button>

                    <button nbButton status="basic" shape="semi-round" class="ml-2" (click)="cancel()">
                      Cancel
                    </button>
                  </div>

                </nb-card-body>
              </div>
            </div>
          </form>
        </div>

      </div>
    </div>
  </nb-card-body>
</nb-card>